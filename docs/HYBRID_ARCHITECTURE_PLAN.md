# æ··åˆæ¶æ§‹æ–¹æ¡ˆï¼šJSON + Supabase

## ğŸ¯ æ¶æ§‹æ¦‚è¿°

æ ¹æ“šæ‚¨çš„éœ€æ±‚ï¼Œæ¡ç”¨æ··åˆæ¶æ§‹æ–¹æ¡ˆï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     è³‡æ–™ä¾†æº                              â”‚
â”‚  DC_Crime + dc_zillow CSV æª”æ¡ˆ                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
                        â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚   combine_data_to_json.py     â”‚
        â”‚   åˆä½µè³‡æ–™æˆ JSON              â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                                â”‚
        â–¼                                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ GCP Storage   â”‚              â”‚   Supabase       â”‚
â”‚ (JSON æª”æ¡ˆ)   â”‚              â”‚   (è³‡æ–™åº«)       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚                                â”‚
        â”‚                                â”‚
        â–¼                                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   å‰ç«¯æ‡‰ç”¨    â”‚              â”‚   AI Agent       â”‚
â”‚ (è®€å– JSON)   â”‚              â”‚ (SQL æŸ¥è©¢)       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“‹ æ¶æ§‹èªªæ˜

### 1. **å‰ç«¯æ‡‰ç”¨** â†’ GCP Cloud Storage (JSON)

**ç”¨é€”**: å‰ç«¯é¡¯ç¤ºè³‡æ–™

**å„ªé»**:
- âœ… ç°¡å–®ç›´æ¥ï¼Œå‰ç«¯åªéœ€ fetch JSON
- âœ… ç„¡éœ€ API ä¼ºæœå™¨ï¼Œæˆæœ¬ä½
- âœ… å¯ä»¥è¨­å®š CDN åŠ é€Ÿ
- âœ… é©åˆéœæ…‹è³‡æ–™å±•ç¤º

**è³‡æ–™æ ¼å¼**: 
- æŒ‰ ZIP Code çµ„ç¹”
- åŒ…å« Crime çµ±è¨ˆå’Œ Zillow è³‡æ–™
- çµæ§‹åŒ–ï¼Œæ˜“æ–¼å‰ç«¯ä½¿ç”¨

### 2. **AI Agent** â†’ Supabase (PostgreSQL)

**ç”¨é€”**: AI Agent éœ€è¦è¤‡é›œæŸ¥è©¢

**å„ªé»**:
- âœ… Supabase å…è²»å±¤å¾ˆå……è¶³
- âœ… PostgreSQL æ”¯æ´è¤‡é›œ SQL æŸ¥è©¢
- âœ… é©åˆ AI Agent çš„è³‡æ–™åˆ†æéœ€æ±‚
- âœ… å¯ä»¥å»ºç«‹è¦–åœ–å’Œå‡½æ•¸

**è³‡æ–™**: 
- ä¸»è¦å„²å­˜ Crime è³‡æ–™
- æ”¯æ´è¤‡é›œæŸ¥è©¢ï¼ˆJOINã€èšåˆã€åœ°ç†æŸ¥è©¢ç­‰ï¼‰

---

## ğŸš€ å¯¦ä½œæ­¥é©Ÿ

### Step 1: åˆä½µè³‡æ–™æˆ JSON (AS-5) âœ…

```bash
python combine_data_to_json.py
```

**è¼¸å‡º**: `dc_crime_zillow_combined.json`

**è³‡æ–™çµæ§‹**:
```json
{
  "metadata": {
    "generated_at": "2025-11-10T...",
    "total_zipcodes": 29,
    "total_crimes": 3573,
    "total_zillow_records": 22
  },
  "data": {
    "20002": {
      "zip_code": "20002",
      "zillow_data": {
        "current_price": 618260.87,
        "mom": -0.127,
        "yoy": -5.15
      },
      "crime_stats": {
        "total_crimes": 496,
        "by_offense": {...},
        "by_shift": {...}
      },
      "crimes": [...]
    }
  }
}
```

### Step 2: ä¸Šå‚³åˆ° GCP Storage (AS-6) âœ…

```bash
python upload_to_gcp_storage.py
```

**è¨­å®š**:
1. å»ºç«‹ GCP Storage Bucket
2. è¨­å®šæœå‹™å¸³è™Ÿæ†‘è­‰
3. ä¸Šå‚³ JSON æª”æ¡ˆ

**å‰ç«¯ä½¿ç”¨**:
```javascript
// ç›´æ¥å¾ GCP Storage è®€å–
fetch('https://storage.googleapis.com/your-bucket/data/dc_crime_zillow_combined.json')
  .then(res => res.json())
  .then(data => {
    // ä½¿ç”¨è³‡æ–™
    console.log(data.data['20002']);
  });
```

### Step 3: ä¸Šå‚³åˆ° Supabase

```bash
python upload_to_supabase.py
```

**è¨­å®š**:
1. å»ºç«‹ Supabase å°ˆæ¡ˆ
2. å»ºç«‹ `crimes` è¡¨
3. è¨­å®šç’°å¢ƒè®Šæ•¸
4. ä¸Šå‚³è³‡æ–™

**AI Agent ä½¿ç”¨**:
```python
from supabase import create_client

supabase = create_client(url, key)

# è¤‡é›œæŸ¥è©¢ç¯„ä¾‹
result = supabase.table('crimes')\
    .select('*')\
    .eq('zip_code', '20002')\
    .gte('report_dat', '2025-01-01')\
    .execute()
```

---

## ğŸ’° æˆæœ¬æ¯”è¼ƒ

### GCP Cloud Storage
- **å…è²»é¡åº¦**: 5 GB å„²å­˜ï¼Œæ¯æœˆ 5,000 æ¬¡è®€å–
- **è¶…å‡ºå¾Œ**: $0.020/GB/æœˆï¼Œ$0.004/10,000 æ¬¡è®€å–
- **é ä¼°**: å®Œå…¨å…è²»ï¼ˆJSON æª”æ¡ˆ < 10 MBï¼‰

### Supabase
- **å…è²»å±¤**: 
  - 500 MB è³‡æ–™åº«
  - 2 GB é »å¯¬
  - 50,000 æ¬¡ API è«‹æ±‚/æœˆ
- **é ä¼°**: å®Œå…¨å…è²»ï¼ˆæ‚¨çš„è³‡æ–™é‡å¾ˆå°ï¼‰

### ç¸½æˆæœ¬
- **æ¯æœˆ**: $0ï¼ˆå…è²»é¡åº¦å…§ï¼‰
- **æ¯å¹´**: $0

---

## âœ… é€™å€‹æ–¹æ¡ˆçš„å„ªé»

### 1. **æˆæœ¬æ•ˆç›Š**
- âœ… å®Œå…¨å…è²»ï¼ˆåœ¨å…è²»é¡åº¦å…§ï¼‰
- âœ… ç„¡éœ€ç¶­è­·ä¼ºæœå™¨
- âœ… æŒ‰éœ€æ“´å±•

### 2. **æ¶æ§‹ç°¡å–®**
- âœ… å‰ç«¯ï¼šç›´æ¥è®€å– JSONï¼Œç„¡éœ€ API
- âœ… AI Agentï¼šä½¿ç”¨ Supabaseï¼ŒåŠŸèƒ½å®Œæ•´
- âœ… è³‡æ–™åˆ†é›¢ï¼Œå„å¸å…¶è·

### 3. **é–‹ç™¼æ•ˆç‡**
- âœ… å‰ç«¯é–‹ç™¼å¿«é€Ÿï¼ˆç„¡éœ€ç­‰å¾… APIï¼‰
- âœ… AI Agent å¯ä»¥ä½¿ç”¨å®Œæ•´ SQL åŠŸèƒ½
- âœ… è³‡æ–™æ›´æ–°ç°¡å–®ï¼ˆé‡æ–°ç”Ÿæˆ JSONï¼‰

### 4. **æ“´å±•æ€§**
- âœ… æœªä¾†å¯ä»¥è¼•é¬†åŠ å…¥ API å±¤ï¼ˆå¦‚æœéœ€è¦ï¼‰
- âœ… Supabase å¯ä»¥æ“´å±•åˆ°ä»˜è²»å±¤
- âœ… GCP Storage å¯ä»¥è¨­å®š CDN

---

## ğŸ”„ è³‡æ–™æ›´æ–°æµç¨‹

```
1. æ›´æ–° CSV è³‡æ–™
   â†“
2. åŸ·è¡Œ combine_data_to_json.py
   â†“
3. åŸ·è¡Œ upload_to_gcp_storage.py (æ›´æ–° JSON)
   â†“
4. åŸ·è¡Œ upload_to_supabase.py (æ›´æ–°è³‡æ–™åº«)
   â†“
5. å‰ç«¯å’Œ AI Agent è‡ªå‹•ä½¿ç”¨æ–°è³‡æ–™
```

---

## ğŸ“Š èˆ‡å…¶ä»–æ–¹æ¡ˆæ¯”è¼ƒ

| æ–¹æ¡ˆ | æˆæœ¬ | è¤‡é›œåº¦ | å‰ç«¯éœ€æ±‚ | AI Agent éœ€æ±‚ | æ¨è–¦åº¦ |
|------|------|--------|----------|---------------|--------|
| **JSON + Supabase** | $0 | ä½ | âœ… ç°¡å–® | âœ… å®Œæ•´ | â­â­â­â­â­ |
| Cloud SQL + API | $10-20/æœˆ | ä¸­ | âœ… ç°¡å–® | âœ… å®Œæ•´ | â­â­â­â­ |
| Firestore + Functions | $0-50/æœˆ | ä¸­ | âœ… ç°¡å–® | âš ï¸ æœ‰é™ | â­â­â­ |

---

## ğŸ¯ å»ºè­°

**é€™å€‹æ–¹æ¡ˆéå¸¸é©åˆæ‚¨çš„éœ€æ±‚ï¼**

1. âœ… **å‰ç«¯ç°¡å–®**: JSON æª”æ¡ˆå®Œå…¨è¶³å¤ 
2. âœ… **AI Agent å¼·å¤§**: Supabase PostgreSQL åŠŸèƒ½å®Œæ•´
3. âœ… **æˆæœ¬ç‚ºé›¶**: éƒ½åœ¨å…è²»é¡åº¦å…§
4. âœ… **ç¶­è­·ç°¡å–®**: ç„¡éœ€ç®¡ç†ä¼ºæœå™¨
5. âœ… **æ“´å±•å®¹æ˜“**: æœªä¾†éœ€è¦æ™‚å¯ä»¥å‡ç´š

**ä¸‹ä¸€æ­¥**:
1. åŸ·è¡Œ `combine_data_to_json.py` ç”Ÿæˆ JSON
2. è¨­å®š GCP Storage ä¸¦ä¸Šå‚³
3. è¨­å®š Supabase ä¸¦ä¸Šå‚³ Crime è³‡æ–™
4. å‰ç«¯å’Œ AI Agent é–‹å§‹ä½¿ç”¨

---

## ğŸ“ æ³¨æ„äº‹é …

1. **JSON æª”æ¡ˆå¤§å°**: å¦‚æœæœªä¾†è³‡æ–™é‡å¾ˆå¤§ï¼Œè€ƒæ…®ï¼š
   - åˆ†æ‹†æˆå¤šå€‹ JSON æª”æ¡ˆï¼ˆæŒ‰å€åŸŸï¼‰
   - ä½¿ç”¨å£“ç¸®ï¼ˆgzipï¼‰
   - è€ƒæ…®åŠ å…¥ API å±¤

2. **è³‡æ–™åŒæ­¥**: 
   - å®šæœŸæ›´æ–° JSON å’Œ Supabase
   - å¯ä»¥è¨­å®šè‡ªå‹•åŒ–è…³æœ¬

3. **å®‰å…¨æ€§**:
   - GCP Storage: è¨­å®šé©ç•¶çš„å­˜å–æ¬Šé™
   - Supabase: ä½¿ç”¨ Row Level Security (RLS)

4. **æ•ˆèƒ½**:
   - JSON: å¯ä»¥è¨­å®š CDN å¿«å–
   - Supabase: ä½¿ç”¨ç´¢å¼•å„ªåŒ–æŸ¥è©¢

